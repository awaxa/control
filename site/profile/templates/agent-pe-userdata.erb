#!/bin/bash

<% case @cloud
when 'vagrant' %>
PE_MASTER='master'
<% else %>
PE_MASTER='<%= @pe_cname %>'
<% end %>

<% case @cloud
when 'aws' %>
PE_CERTNAME=$(curl -s http://169.254.169.254/latest/meta-data/instance-id)
<% else %>
PE_CERTNAME=$(hostname)
<% end %>

curl -sk https://$PE_MASTER:8140/packages/current/install.bash | /bin/bash -s agent:certname=$PE_CERTNAME
